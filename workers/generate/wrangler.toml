name = "creator-tool-hub"
main = "src/index.ts"
compatibility_date = "2025-01-15"

# Database configuration
[[d1_databases]]
binding = "DB"
database_name = "creator-tool-hub-db"
database_id = "89b83057-3c64-489e-97de-152a7197cd91"

# R2 bucket configuration
[[r2_buckets]]
binding = "R2"
bucket_name = "creator-tool-hub-user-data"

# Environment variables
[vars]
NODE_ENV = "production"
FEATURE_ID = "credits"
MODEL_ID = "gemini-3-pro-image-preview"
ALLOWED_ORIGINS = "https://creatortoolhub.com,https://www.creatortoolhub.com,http://localhost:3000,http://127.0.0.1:3000"
PUBLIC_FILE_BASE_URL = "https://creatortoolhub.com"
R2_PUBLIC_URL = "https://pub-d8e8e8e8e8e8e8e8.r2.dev"

# Secrets (these need to be set separately with `wrangler secret put`)
# GEMINI_API_KEY - Set with: wrangler secret put GEMINI_API_KEY
# AUTUMN_SECRET_KEY - Set with: wrangler secret put AUTUMN_SECRET_KEY
# FAL_KEY - Set with: wrangler secret put FAL_KEY
# Note: FAL_MODEL is hardcoded to fal-ai/flux-2-pro/edit

# Routes for user data APIs only (not /api/generate or /api/autumn - those are handled by Next.js)
# The Next.js /api/generate route will proxy to the worker at its workers.dev subdomain
routes = [
  # { pattern = "creatortoolhub.com/api/generate", zone_name = "creatortoolhub.com" },  # Commented out - handled by Next.js
  # { pattern = "creatortoolhub.com/api/autumn/*", zone_name = "creatortoolhub.com" },  # Commented out - handled by Next.js
  { pattern = "creatortoolhub.com/api/user/*", zone_name = "creatortoolhub.com" },
  { pattern = "creatortoolhub.com/api/auth/*", zone_name = "creatortoolhub.com" },

  { pattern = "creatortoolhub.com/api/r2/*", zone_name = "creatortoolhub.com" },
  { pattern = "creatortoolhub.com/r2/*", zone_name = "creatortoolhub.com" }
]

# Development environment configuration
[env.development]
vars = { NODE_ENV = "development", FEATURE_ID = "credits", MODEL_ID = "gemini-3-pro-image-preview", ALLOWED_ORIGINS = "https://creatortoolhub.com,https://www.creatortoolhub.com,http://localhost:3000,http://127.0.0.1:3000", PUBLIC_FILE_BASE_URL = "http://localhost:8787" }

# Database configuration for development
[[env.development.d1_databases]]
binding = "DB"
database_name = "creator-tool-hub-db"
database_id = "89b83057-3c64-489e-97de-152a7197cd91"

# R2 bucket configuration for development
[[env.development.r2_buckets]]
binding = "R2"
bucket_name = "creator-tool-hub-user-data"

